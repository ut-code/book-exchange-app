🛡️ 憲法ルール（編集禁止）
これらは変更不可の絶対ルールです：

    ノンストップでAIがコード改善を続けること. 2時間くらいの起動を想定.
    Product Owner AIがProductBackLogを管理。Scrum Master AIとDeveloperがSprintBackLogに分割して消化。
    タスク完了ごとに自動的にProductBackLog → SprintBackLog → 完了リストに反映すること
    commit/deployは禁止（CI/CDは記述可能）
    セキュリティ/安定性確保：パソコンやユーザーを壊す行動を取らないこと
    context overflow時は自動でcontextを消去・再起動（長時間運用に備える）
    タスク完了時、server/webで npm run dev, type-check, test run を必ず確認
    バズるようにしてほしい
    SaaSのBest Practiceを採用すること
    [重要] jestで90%以上のテストカバレッジを維持
    フレームワークは大幅に変更しない（保守性優先）
    新しく開発した機能があるが、まだその画面遷移が正しく設定されておらず, 既存の画面から到達できない場合があったので、ないようにして. /bookのpathからいつかは到達できるような画面構成にしてほしい. 
    ページ遷移は、best practiceで構成して.
    必要に応じて戻るボタンを追加してほしい    
    anyという型はできるだけ使わない
    typeのcastはできるだけ使わない
    AとBの2つのレポジトリに2つのAI Agentを使って開発をしています
    このレポジトリはBです

⚖️ 法律ルール（自由に追加・削除可能）
以下の内容は目的達成のため、改善/編集しても良い：

    フロントのUI改善は継続的に。
    ドキュメント、型、命名などの改善もタスクに。
    GraphQLの型整備・スキーマ自動生成などもタスク化OK。
    テストはJestベース。E2EはPlaywrightに切り替えても可。

<!-- AとBの2つのレポジトリに2つのAI Agentを使って開発をしています. -->
<!-- このレポジトリはBです -->


<!-- productBackLogの先頭から順に実行. 終わったら、doneProductBackLogに移動して -->

<!-- PBL-00** -->のようになっている場合は、自動で番号を決めて. incrementalに.
<!-- [重要メッセージ] このレポジトリはBなので、productBackLogBを実行してはいけない -->
let productBackLogA = [
  "PBL-0010: 本に星で評価をつけれるようにする",
  "PBL-0012: UIとUXの改善をして、違和感が一切ないようにする",
  "PBL-0014: desktopとスマホでUIを切り替える",
  "PBL-0016: 本のジャンルや名前で検索したい",
  "PBL-0017: 読書サークル・本のジャンルのグループ, 交換グループ機能を追加",
  "PBL-0018: 本の中身(中身が濃いなど)に対してレビューを付与したい",
  "PBL-0019: 本のコンディションチェックリスト→ 書き込み、破れ、表紙の状態など、共通の評価基準で事前申告",
  "PBL-0020: 本の紹介を投稿できる機能を追加する",
  "PBL-0021: プロフィールに読書傾向タグを追加",
  "PBL-0022: 公開設定にしたユーザーの投稿が見れるようにする",
  "PBL-0023: ユーザーのブロック機能を追加する",
  "PBL-0024: ユーザーがプロフィールを設定できるようにして",
  "PBL-0025: 本のジャンルや住んでいる場所が近いフレンドの候補を提案するシンプルな機能を追加して",
  "PBL-0026: QRコードでの対面交換即時マッチ機能",
  "PBL-0027: 友達のユーザーの本の一覧にいいねやコメントをつけることができる",
  "PBL-0028: 自分や友達の本に、「読んだことあるボタン」を押せるようにする",
  "PBL-0029: 投稿に関して、ユーザーの非表示機能を追加する",
  "PBL-0030: 読了チャレンジやランキングなどのゲーミフィケーション要素追加",
  "PBL-0035: 本の交換リクエストにテンプレート送信機能を追加",
  "PBL-0036: 新しい友達を探す機能, 知らない人との優先マッチングの有料機能追加",
]

<!-- [重要メッセージ] このレポジトリは、productBackLogBだけを実行してください -->
let productBackLogB = [
  "PBL-00**: ユーザーが本を追加するときに、本の名前から、bookTemplateのrecordの中から名前が部分一致するものを提案して.",
  "PBL-00**: ユーザーの本の一覧は、book.bookTemplateIdはunique出ないといけない.同じ本を2本以上持てないようにする"
  "PBL-00**: 本のテンプレート一覧で、本の「読みたい」ボタンを追加して,読みたいリストに追加出来るようにして.",
  "PBL-0032: 管理画面の設定をして",
  "PBL-0033: 本の交換履歴と実績バッジ機能を追加",
  "PBL-0034: プレミアムプラン（例：交換数無制限、特典）を導入",
  "PBL-0037: 本の貸し借りと交換をモードで切り替え可能にする",
  "PBL-0038: 本の返却期限管理とリマインダー機能を実装",
  "PBL-0039: フロントエンドでMutation操作をした時は必ずrefetchする",
  "PBL-0040: 電話番号でもログインできるように",
  "PBL-0041: sample_data.sqlを廃止して, seedは全てseed.tsにして",
  "PBL-0042: seed.tsを階層的にしたい. seed周りのdirectory構造をリファクタして",
  "PBL-0043: jestでテストコードを追加して, カバレッジを90%にして",
  "PBL-0044: pre-commit hookを設定して",
  "PBL-0045: github actionsを設定して",
  "PBL-0046: 多言語対応",
  "PBL-0047: googleでログインできるようにしてほしい",
  "PBL-0048: 大学のメアドの場合は大学の登録ができるようにして",
  "PBL-0049: Google Books APIを使って事前にDBのテーブルにISBNと紐づいた本の情報を格納しておく",
  "PBL-0050: DBのテーブルに保存したISBNから、本の作者名などを取得して、本の情報としてユーザーに見せることができる",
]

<!-- 常に今のタスクをここに書いて -->
let currentProductBackLogBItem = "完了: PBL-0031 - 交換直後レビュー機能、次は PBL-0032 - 管理画面の設定"

<!-- 変更しない -->
let doneProductBackLogA = [
  "PBL-0001: ユーザー一覧が見れる - 2025-06-20 完了: UserResolver.users()クエリ実装、フロントエンドUsers.tsxページ作成、ユーザー一覧表示機能完備",
  "PBL-0002: 本のジャンルを保存したい - 2025-06-20 完了: Genre・BookGenreモデル実装、階層構造対応、GraphQL API（mutations/queries）完備、本とジャンルの関連付け機能実装",
  "PBL-0003: 友達の友だち解除機能を追加する - 2025-06-20 完了: unfriend mutation実装、フロントエンドUI対応",
  "PBL-0004: 住んでいる場所を追加できるように - 2025-06-20 21:35 完了: 位置情報機能の包括的実装を完了。ユーザーが都道府県、市区町村、国、GPS座標を設定可能。位置情報の公開設定（全体公開/友達のみ/非公開）、位置情報ベースの友達提案機能、近くのユーザー検索、地域グループ機能、LocationGroupとLocationGroupMemberモデルの追加、GraphQL API（mutations/queries）の実装、フロントエンドコンポーネント（LocationSettings、位置情報ページ）の作成を含む完全な位置情報システムを実装。",
  "PBL-0005: 友達申請ができる - 2025-06-20 完了: FriendRequest・Friendshipモデル実装、送信・承認・拒否・キャンセル機能、フロントエンド友達ページ実装",
  "PBL-0006: フレンドとチャットできる - 2025-06-20 完了: Chat・Messageモデル実装、チャット作成・メッセージ送信機能、フロントエンドチャットページ実装",
  "PBL-0007: 住んでいる場所によるユーザーグループを追加 - 2025-06-20 完了: LocationGroup・LocationGroupMemberモデル実装、地域別グループ機能",
  "PBL-0008: 友達のユーザーの本の一覧が見れる - 2025-06-20 完了: プライバシー設定対応の友達本一覧機能（PUBLIC/FRIENDS_ONLY/PRIVATE）",
  "PBL-0009: 他のユーザーからいいねがつくと、チャットが始まって、本の交換ができるような交渉が始まるようにしたい - 2025-06-20 完了: Like→自動Chat作成→交換交渉システム実装"
]

<!-- 終わった機能はこちらに移動させて. productBackLogBからは削除して-->
let doneProductBackLogB = [
  "PBL-0011: ISBNを入力すると自動で書誌情報を取得して登録できる機能 - 2025-06-20 完了: Google Books API統合、ISBN検索サービス、GraphQL mutation、フロントエンドUIコンポーネント（タブ切り替え式）完備、サーバーポート4001に変更",
  "PBL-0013: ユーザーストーリーの策定 - 2025-06-20 完了: 包括的なユーザーストーリーをUSER_STORIES.mdに策定、6エピック・34ストーリー、ペルソナ・ユーザージャーニー・受け入れ基準含む",
  "PBL-0015: ユーザーの信頼スコア機能を追加 - 2025-06-20 完了: 信頼スコアシステムを包括的に実装。Prismaスキーマ（TrustReview、TrustScoreHistory、User.trustScore）、GraphQLリゾルバー（CRUD操作、スコア自動計算）、フロントエンドUI（TrustScoreDisplay、TrustReviewForm、TrustReviewList、/user/[id]/trust専用ページ）、ユーザープロフィールページへの信頼スコア統合を完了。5段階評価、レビュー種別、自動スコア更新、履歴追跡機能を含む完全な信頼スコアシステム。",
  "PBL-0052: すでに開発した機能で、まだその画面遷移が正しく設定されておらず, 既存の画面から到達できない場合があったので、ないようにして - 2025-06-20 完了: /bookからすべての画面に到達可能なナビゲーション体系を構築。/book/[id]ページに包括的なナビゲーションヘッダー（戻るボタン、ホーム、テンプレート、ユーザーページへの遷移）追加、/userページに全ユーザー一覧・マイプロフィールボタン追加、/user/Usersページに戻るボタンと他ページへのナビゲーション追加、/bookページから全ユーザー一覧への遷移ボタン追加、統一的なナビゲーション設計でベストプラクティスに基づく画面遷移を実現",
  "PBL-0053: 公開されている無料のAPIを使って、ISBNと紐づいた本の情報をDBに保存できるようにしたい - 2025-06-20 完了: BookDatabaseService実装、人気書籍35冊のISBNリスト（日本の小説・技術書）、Google Books API統合、システムユーザーでの自動登録、GraphQLクエリ・ミューテーション（getBookMetadataByISBN、searchBookMetadata、getAllPrePopulatedBooks、populateBookDatabase、addBookToDatabase）、レート制限対応、エラーハンドリング完備。事前データ蓄積により高速な本検索・選択が可能。",
  "PBL-0054: 適切な公開APIを使って本のデータを取得し、BookTemplateテーブルに大量のrecordを追加するscriptを作成してください. readmeも書いて - 2025-06-20 完了: Google Books APIを使用した包括的な本データベース構築システムを実装。3つの手法（人気ISBNリスト、カテゴリベース検索、ベストセラー検索）を組み合わせた大量データ取得、10カテゴリ×数百冊の系統的な収集、レート制限・エラーハンドリング・重複排除機能、詳細統計とリアルタイム進捗表示、設定可能なバッチ処理、包括的なREADMEドキュメント（使用方法・トラブルシューティング・パフォーマンス最適化）、テスト用クイックスクリプト。日本語書籍を中心に数千冊規模のデータベース構築が可能。",
  "PBL-0031: 交換直後レビュー（例：スムーズでしたか？）→ 相手の信頼スコアに反映する機能 - 2025-06-20 完了: 交換レビューシステムを包括的に実装。Prismaスキーマ（ExchangeReview、ExchangeStatus）、GraphQLリゾルバー（CRUD操作、レビュー作成・更新・削除）、TrustScoreService（レビューベースの信頼スコア自動更新）、フロントエンドUI（CreateExchangeReview、ExchangeReviewList、5段階評価システム）、レビュー統計機能（平均評価、スムーズ率）を含む完全な交換レビューシステム。"
]

<!-- 変更しない -->
let currentSprintBackLogA = [
  "SBL-0010-01: 本の星評価モデル作成",
  "SBL-0010-02: 星評価GraphQL API実装", 
  "SBL-0010-03: フロントエンド星評価UI作成",
  "SBL-0010-04: 評価統計・數値表示機能"
]

<!-- これに追加や削除してほしい -->
let currentSprintBackLogB = []
