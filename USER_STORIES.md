# 本交換アプリ - ユーザーストーリー策定

## アプリケーション概要

本交換アプリは、ユーザー同士が本を交換できるソーシャルプラットフォームです。現在実装されている機能を基に、包括的なユーザーストーリーを策定します。

## 現在の技術スタック

### バックエンド (packages/server)
- **フレームワーク**: NestJS with GraphQL
- **データベース**: PostgreSQL with Prisma ORM
- **認証**: JWT with bcrypt password hashing
- **API**: Google Books API統合
- **ポート**: 4001

### フロントエンド (packages/web)
- **フレームワーク**: Next.js with React
- **UI**: Material-UI (MUI)
- **状態管理**: Apollo Client for GraphQL
- **スタイリング**: Material-UI components

## 現在のデータモデル

### 1. User（ユーザー）
```typescript
- id: String (UUID)
- username: String (ユニーク)
- password: String
- hashedPassword: String
- deletedAt: DateTime? (論理削除)
- posts: Post[]
- books: Book[]
- requesterExchangeRequest: ExchangeRequest[]
- addresseeExchangeRequest: ExchangeRequest[]
```

### 2. Book（本）
```typescript
- id: String (UUID)
- title: String
- description: String
- isbn: String? (ユニーク)
- author: String?
- publisher: String?
- publishedDate: String?
- pageCount: Int?
- language: String?
- categories: String[]
- imageUrl: String?
- infoLink: String?
- createdAt: DateTime
- updatedAt: DateTime
- userId: String (外部キー)
- user: User
```

### 3. Post（投稿）
```typescript
- id: String (UUID)
- title: String
- content: String
- published: Boolean
- viewCount: Int
- createdAt: DateTime
- updatedAt: DateTime
- userId: String (外部キー)
- user: User
```

### 4. ExchangeRequest（交換リクエスト）
```typescript
- id: String (UUID)
- requesterUserId: String (リクエスト送信者)
- addresseeUserId: String (リクエスト受信者)
- createdAt: DateTime
- updatedAt: DateTime
- requesterUser: User
- addresseeUser: User
```

## 実装済み機能

### 認証・ユーザー管理
- ✅ ユーザー登録（username/password）
- ✅ ログイン機能
- ✅ ログアウト機能
- ✅ ユーザー削除（論理削除）
- ✅ 認証ガード（JWT）
- ✅ ユーザー一覧表示

### 本管理
- ✅ 手動での本登録（title/description）
- ✅ ISBN入力による自動本登録（Google Books API連携）
- ✅ 本の詳細情報表示（著者、出版社、ページ数、カテゴリ等）
- ✅ 本の編集・更新
- ✅ 本の削除（単体・複数）
- ✅ ユーザーの本一覧表示
- ✅ 全ユーザーの本一覧表示
- ✅ ユーザー別本一覧表示

### 投稿機能
- ✅ 投稿作成
- ✅ 投稿一覧表示
- ✅ 下書き機能
- ✅ 投稿の公開/非公開切り替え
- ✅ 投稿削除
- ✅ 閲覧数カウント

### UI/UX
- ✅ レスポンシブデザイン（Material-UI）
- ✅ タブ切り替え式本登録画面
- ✅ ユーザー情報表示コンポーネント
- ✅ リンク共有機能
- ✅ ローディング状態表示
- ✅ エラーハンドリング
- ✅ 成功メッセージ表示

### ページ構成
- `/` - ホーム（ユーザーページにリダイレクト）
- `/user` - ユーザー管理（登録・ログイン・ログアウト）
- `/book` - 本管理（一覧・作成・編集）
- `/book/[id]` - 本の詳細
- `/user/[id]` - ユーザー詳細

## ユーザーストーリー

### エピック1: ユーザー認証とプロフィール管理

#### ストーリー1.1: 新規ユーザー登録
**As a** 新規ユーザー  
**I want to** ユーザー名とパスワードでアカウントを作成する  
**So that** アプリを利用して本の交換ができるようになる

**受け入れ基準:**
- [ ] ユニークなユーザー名で登録できる
- [ ] パスワードは安全にハッシュ化される
- [ ] 登録後自動的にログイン状態になる
- [ ] 既存ユーザー名の場合はエラーメッセージが表示される

#### ストーリー1.2: ユーザーログイン
**As a** 既存ユーザー  
**I want to** ユーザー名とパスワードでログインする  
**So that** 自分のアカウントにアクセスできる

**受け入れ基準:**
- [x] 正しい認証情報でログインできる
- [x] 間違った認証情報の場合はエラーメッセージが表示される
- [x] ログイン後はJWTトークンが発行される
- [x] ログイン状態が保持される

#### ストーリー1.3: ユーザープロフィール表示
**As a** ログインユーザー  
**I want to** 自分のプロフィール情報を確認する  
**So that** アカウント情報を把握できる

**受け入れ基準:**
- [x] ユーザー名が表示される
- [x] 認証状態が表示される
- [x] アバターが表示される（ユーザー名の初期文字）

### エピック2: 本の管理

#### ストーリー2.1: 手動での本登録
**As a** ユーザー  
**I want to** 本のタイトルと説明を入力して本を登録する  
**So that** 自分の蔵書を管理できる

**受け入れ基準:**
- [x] タイトルと説明を入力できる
- [x] 登録後に本一覧に表示される
- [x] 必須項目（タイトル）が未入力の場合は登録できない

#### ストーリー2.2: ISBNによる自動本登録
**As a** ユーザー  
**I want to** ISBNを入力して本の詳細情報を自動取得して登録する  
**So that** 手間をかけずに正確な書誌情報で本を登録できる

**受け入れ基準:**
- [x] ISBNを入力すると自動的に書誌情報が取得される
- [x] Google Books APIから著者、出版社、画像等の情報が取得される
- [x] 追加の説明文を任意で入力できる
- [x] ISBN検索結果が見つからない場合はエラーメッセージが表示される

#### ストーリー2.3: 本一覧の表示
**As a** ユーザー  
**I want to** 自分の登録した本の一覧を見る  
**So that** 所有している本を把握できる

**受け入れ基準:**
- [x] 自分が登録した本が一覧表示される
- [x] 本の基本情報（タイトル、著者、画像等）が表示される
- [x] 最新の本が上部に表示される（逆順）

#### ストーリー2.4: 本の編集・削除
**As a** ユーザー  
**I want to** 登録した本の情報を編集または削除する  
**So that** 正確な蔵書管理ができる

**受け入れ基準:**
- [x] 本の情報を編集できる
- [x] 本を削除できる
- [x] 複数の本を一括削除できる
- [x] 削除時は確認メッセージが表示される

### エピック3: 他ユーザーとの交流

#### ストーリー3.1: 他ユーザーの本一覧表示
**As a** ユーザー  
**I want to** 他のユーザーが登録している本を見る  
**So that** 交換したい本を見つけることができる

**受け入れ基準:**
- [x] 全ユーザーの本が一覧表示される
- [x] 各本の所有者情報が表示される
- [x] 本の詳細情報が確認できる

#### ストーリー3.2: ユーザー一覧表示
**As a** ユーザー  
**I want to** 他のユーザーの一覧を見る  
**So that** 交換相手を見つけることができる

**受け入れ基準:**
- [x] 登録済みユーザーの一覧が表示される
- [x] 各ユーザーの基本情報が表示される
- [x] ユーザー詳細ページにアクセスできる

### エピック4: 投稿・コミュニケーション

#### ストーリー4.1: 投稿作成
**As a** ユーザー  
**I want to** 本に関する投稿を作成する  
**So that** 他のユーザーと本について情報共有できる

**受け入れ基準:**
- [x] タイトルと内容を入力して投稿を作成できる
- [x] 下書きとして保存できる
- [x] 公開・非公開を切り替えられる

#### ストーリー4.2: 投稿一覧表示
**As a** ユーザー  
**I want to** 投稿の一覧を見る  
**So that** コミュニティの活動を把握できる

**受け入れ基準:**
- [x] 公開された投稿が一覧表示される
- [x] 投稿の閲覧数が表示される
- [x] 投稿の詳細が確認できる

### エピック5: 交換システム（基盤実装済み）

#### ストーリー5.1: 交換リクエスト送信
**As a** ユーザー  
**I want to** 他のユーザーに本の交換リクエストを送信する  
**So that** 欲しい本を手に入れることができる

**受け入れ基準:**
- [ ] 他ユーザーの本に対して交換リクエストを送信できる
- [ ] リクエスト送信時にメッセージを添付できる
- [ ] 送信したリクエストの一覧を確認できる

#### ストーリー5.2: 交換リクエスト受信・対応
**As a** ユーザー  
**I want to** 受信した交換リクエストを確認し、承認または拒否する  
**So that** 交換の可否を決定できる

**受け入れ基準:**
- [ ] 受信したリクエストの一覧を確認できる
- [ ] リクエストを承認または拒否できる
- [ ] 対応状況がリクエスト送信者に通知される

### エピック6: UI/UX改善

#### ストーリー6.1: レスポンシブデザイン
**As a** ユーザー  
**I want to** どのデバイスからでも快適にアプリを利用する  
**So that** いつでもどこでも本の交換ができる

**受け入れ基準:**
- [x] モバイルデバイスで適切に表示される
- [x] タブレットで適切に表示される
- [x] デスクトップで適切に表示される

#### ストーリー6.2: ナビゲーション改善
**As a** ユーザー  
**I want to** 直感的にアプリ内を移動する  
**So that** ストレスなく機能を利用できる

**受け入れ基準:**
- [x] メインページ間の移動が簡単
- [x] 戻るボタンが適切に配置されている
- [x] 現在のページが明確に示されている

## 技術的実装状況

### 完了済み実装
1. **認証システム**: JWT based authentication
2. **データベース設計**: Prisma ORM with PostgreSQL
3. **GraphQL API**: 完全なCRUD操作
4. **Google Books API**: ISBN検索と自動データ取得
5. **フロントエンド**: Material-UI components
6. **基本的なページ構成**: ユーザー管理・本管理画面

### 次期実装候補（ProductBackLogBより）
1. **信頼スコア機能**: ユーザーの信頼性評価
2. **交換履歴と実績バッジ**: ユーザーの活動記録
3. **管理画面**: アプリ運営管理機能
4. **プレミアムプラン**: 収益化機能
5. **本の貸し借りモード**: 交換以外の利用形態
6. **多言語対応**: 国際化対応
7. **ソーシャルログイン**: Google認証
8. **テストカバレッジ向上**: Jest testing

## まとめ

現在の本交換アプリは基本的な本管理機能とユーザー管理機能が完成しており、Google Books API連携による自動書誌情報取得など高度な機能も実装済みです。交換システムの基盤（ExchangeRequestモデル）は用意されているため、今後はユーザー間の実際の交換機能の実装が主要なタスクとなります。

UI/UXは Material-UI を使用して現代的なデザインが採用されており、レスポンシブ対応も完了しています。技術スタックは堅牢で拡張性があり、今後の機能追加に対応できる構造となっています。